<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대만 여행 계획표</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome 아이콘 로드 (안정성 확보) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- React 및 Babel 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 사용자 지정 스크롤바 숨기기 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <!-- JSX 코드를 Babel을 이용해 실행 -->
    <script type="text/babel">
        // React Hooks 명시적 참조
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;
        
        // API Key (이 부분은 사용하지 않으므로 빈 문자열로 유지)
        const apiKey = "";

        // 아이콘 컴포넌트 (Font Awesome 기반)
        const Icon = ({ iconType, className = "w-5 h-5", color, isCompleted }) => {
            const faClasses = {
                'flight': 'fa-plane-departure',
                'hotel': 'fa-hotel',
                'tour': 'fa-bus-simple',
                'guide': 'fa-circle-info',
                'camera': 'fa-camera-retro',
                'food': 'fa-utensils',
                'activity': 'fa-store',
                'bus': 'fa-bus',
                'transport': 'fa-train-subway',
                'landmark': 'fa-archway',
                'sunset': 'fa-sun',
                'moon': 'fa-moon',
                'bookopen': 'fa-book-open',
                'map': 'fa-map-location-dot',
                'externalLink': 'fa-up-right-from-square',
                'x': 'fa-xmark',
                'home': 'fa-house',
                // 체크박스 아이콘: 완료 여부에 따라 원형 아이콘 색상 변경 (겹침 문제 해결)
                'checkcircle': isCompleted ? 'fa-circle-check' : 'fa-circle',
            };

            const faIcon = faClasses[iconType.toLowerCase()] || 'fa-location-dot'; // 기본값

            return (
                <i 
                    className={`fa-solid ${faIcon} ${className} transition-colors`} 
                    style={{ color: color }}
                ></i>
            );
        };

        const TaiwanTravelApp = () => {
          // PRIMARY COLOR DEFINITION (요청하신 색상 #1768AC)
          const PRIMARY_COLOR = '#1768AC';

          // 초기 데이터 설정
          const initialItinerary = [
            {
              day: 1,
              date: '12월 24일 (수)',
              title: '대만 도착 및 시먼딩 여행', 
              events: [
                {
                  id: 'd1-flight',
                  time: '10:50',
                  title: '부산 출발',
                  type: 'flight',
                  description: '에어부산 BX793 / 김해국제공항',
                  location: '김해국제공항',
                  completed: false
                },
                {
                  id: 'd1-arrival',
                  time: '12:40',
                  title: '타오위안 공항 도착 & 픽업',
                  type: 'flight',
                  description: '입국 수속 후 픽업 장소로 이동',
                  location: 'Taoyuan International Airport',
                  completed: false
                },
                {
                  id: 'd1-pickup',
                  time: '13:30',
                  title: '픽업 샌딩 미팅',
                  type: 'guide',
                  description: '예약된 기사님 미팅 장소 확인',
                  location: 'Taoyuan Airport Terminal 2',
                  hasGuideContent: true,
                  completed: false
                },
                {
                  id: 'd1-hotel',
                  time: '15:00',
                  title: '타이 호프 호텔 (Taihope Hotel)',
                  type: 'hotel',
                  description: '체크인 및 짐 풀기',
                  location: 'Tai Hope Hotel',
                  completed: false
                },
                {
                  id: 'd1-move-sanmi', 
                  time: '15:40',
                  title: '시먼딩으로 이동', 
                  type: 'transport',
                  description: 'MRT 난징푸싱(Green) -> 시먼 환승(Blue) -> 시먼역 6번 출구 (약 35분 소요)',
                  location: 'Ximen Station',
                  completed: false,
                  hasWaitingInfo: true 
                },
                {
                  id: 'd1-seal', 
                  time: '16:20',
                  title: '일성주자소 (활자 도장 제작 가능)', 
                  type: 'activity',
                  description: '도장 재료 구경 및 디자인 선택', 
                  location: 'Yisheng Zhuzhao',
                  completed: false,
                  knowledgeContent: {
                    title: '✍️ 일성주자소 (Yisheng Zhuzhao)',
                    text: `1. 활자 도장의 매력:
            - 일성주자소는 대만에서 유일하게 활자 주조기를 이용해 전통적인 방식으로 도장을 제작하는 곳입니다.
            - 한국의 수제 도장과는 달리, 대만의 활자 도장은 정교하고 깔끔한 기계식 인쇄 활자를 사용해 깊이 있는 매력을 가집니다.
        
            2. 제작 과정 및 팁:
            - 원하는 도장 재질과 크기를 선택합니다. (나무, 돌, 아크릴 등)
            - 새길 이름이나 문구(한자 또는 한글)를 전달하면 활자를 조합하여 도장을 찍습니다.
            
            3. 주소: No. 10, Lane 8, Section 2, Hankou St, Wanhua District, Taipei City, Taiwan 108`
                  }
                },
                {
                  id: 'd1-longshan',
                  time: '16:30',
                  title: '용산사 관람',
                  type: 'landmark',
                  description: '타이베이 가장 오래된 사찰 & 점괘 체험 (일성주자소에서 도보 이동)',
                  location: 'Longshan Temple',
                  completed: false,
                  knowledgeContent: {
                    title: '🐉 용산사 점괘(즈자오) 보는 법',
                    text: `1. 용산사란?: 1738년에 지어진 타이베이에서 가장 오래된 사찰입니다. 전쟁과 지진 속에서도 본전의 관세음보살상은 파괴되지 않아 영험하기로 소문났습니다.
        
            2. 점괘 보는 순서 (재미로 보세요!):
               ① 자기소개: 향을 피우고 이름, 나이, 주소, 소원을 마음속으로 말합니다.
               ② 반달 조각(즈자오) 던지기: 붉은색 반달 조각 2개를 바닥에 던집니다.
               ③ 신의 응답 확인:
                  - 성배 (볼록+평평): YES! (소원이 이루어짐) -> 3번 연속 나오면 점괘 막대를 뽑으세요.
                  - 소배 (볼록+볼록): 웃음 (알 수 없음/다시 질문)
                  - 음배 (평평+평평): NO (허락하지 않음)
               ④ 점괘 풀이: 3번 연속 성배가 나와 막대를 뽑았다면, 해당 번호의 서랍을 열어 점괘 종이를 가집니다.
        
            3. 관람 팁:
               - 건축미: 지붕의 용 조각과 기둥은 못을 전혀 사용하지 않은 전통 방식으로 만들어져 예술적 가치가 매우 높습니다.
               - 야경: 밤에는 붉은 등불이 켜져 낮과는 또 다른 신비롭고 화려한 분위기를 자아냅니다.
               - 다양한 신: 본전 뒷편에는 학문의 신, 재물의 신, 인연의 신(월하노인) 등 다양한 도교 신들이 모셔져 있으니 필요한 운세에 맞춰 기도해보세요.`
                  }
                },
                {
                  id: 'd1-dinner',
                  time: '17:10',
                  title: '저녁 식사 (삼미식당)',
                  type: 'food',
                  description: '대왕 연어 초밥 & 닭꼬치 (용산사에서 도보 이동)',
                  location: 'Sunway Restaurant Taipei',
                  completed: false
                }
              ]
            },
            {
              day: 2,
              date: '12월 25일 (목)',
              title: '🎄 크리스마스 풀코스 (화산 1914 & 신이 지구)',
              events: [
                {
                  id: 'd2-morning-move',
                  time: '10:00',
                  title: '호텔 -> 화산 1914 이동',
                  type: 'transport',
                  description: 'MRT 난징푸싱(Green) -> 중샤오신성역(Blue) 1번 출구',
                  location: 'Huashan 1914 Creative Park',
                  completed: false
                },
                {
                  id: 'd2-huashan',
                  time: '10:30',
                  title: '화산 1914 창의문화원',
                  type: 'activity',
                  description: '빈티지 건물 사진, Wooderful Life 구경 (상점 11시 오픈)',
                  location: 'Huashan 1914 Creative Park',
                  completed: false,
                  knowledgeContent: {
                    title: '🎨 화산 1914 즐기는 법',
                    text: `1. 역사: 일제강점기 주조장이었던 건물을 개조하여 만든 복합 문화 공간입니다. 빈티지한 건물 외관 덕분에 스냅 사진 명소로 유명합니다.
        
            2. 관람 팁:
               - 오전 일찍 도착해 상점 오픈 전에 야외에서 사진을 찍으세요. 사람이 적어 여유롭습니다.
               - 'Wooderful Life'는 나무 오르골과 장난감으로 유명합니다. 기념품을 구경하거나 구매하기 좋습니다.
               - 단지 내에 크고 작은 갤러리와 카페가 많으니 여유롭게 둘러보세요.`
                  }
                },
                {
                  id: 'd2-lunch',
                  time: '12:30',
                  title: '점심 식사 (자유식)',
                  type: 'food',
                  description: '화산 1914 단지 내 레스토랑 또는 근처 식당 이용',
                  location: 'Zhongxiao Xinsheng area',
                  completed: false
                },
                {
                  id: 'd2-move-songshan',
                  time: '13:30',
                  title: '쑹산 문화창의공원 이동',
                  type: 'transport',
                  description: 'MRT 중샤오신성역 -> 국부기념관역(Blue Line 2정거장)',
                  location: 'Songshan Cultural and Creative Park',
                  completed: false
                },
                {
                  id: 'd2-songshan',
                  time: '14:00',
                  title: '쑹산 문화창의공원 및 주변 관광',
                  type: 'landmark',
                  description: 'Not Just Library(옛 목욕탕 도서관) 구경 및 성품서점 쇼핑',
                  location: 'Songshan Cultural and Creative Park',
                  completed: false,
                  knowledgeContent: {
                    title: '🌳 쑹산 문화창의공원 (CC Park) & 꿀팁',
                    text: `1. 역사: 1937년 담배공장이었던 곳을 재활용한 공간으로, 화산 1914보다 규모가 크고 현대적인 전시와 상점이 많습니다.
        
            2. 핵심 명소:
               - Not Just Library: 옛 목욕탕을 개조한 도서관으로, 독특한 분위기 때문에 사진을 찍기 좋습니다. (입장료 50 TWD)
               - 성품서점(Eslite Bookstore): 대만의 대형 서점 체인으로, 쑹산점에는 다양한 디자인 상품과 기념품을 판매합니다.
               - 우바오춘 베이커리: 대만 유명 베이커리입니다. 펑리수나 빵을 여기서 구입하여 간식으로 드셔보세요.
        
            3. 관람 팁: 주변의 타이페이 돔을 지나 신이 지구로 걸어가면서 해 질 녘 야경을 미리 감상하는 것을 추천합니다.`
                  }
                },
                {
                  id: 'd2-move-xinyi',
                  time: '16:30',
                  title: '신이 지구 이동 (타이페이 돔 지나 산책)',
                  type: 'activity',
                  description: '도보로 타이페이 돔, 주변 거리 공연을 지나 신이 지구로 이동',
                  location: 'Xinyi District',
                  completed: false
                },
                {
                  id: 'd2-bellavita',
                  time: '17:30',
                  title: '벨라비타 백화점 (BELLAVITA) 구경',
                  type: 'activity',
                  description: '1층 광장의 유럽풍 크리스마스 마을 장식 관람 (사진 명소)',
                  location: 'Bellavita',
                  completed: false
                },
                {
                  id: 'd2-dinner',
                  time: '18:30',
                  title: '저녁 식사 예약 (낙천황조)',
                  type: 'food',
                  description: '8색 샤오롱바오 / 브리즈 신이(Breeze Xinyi) 4층 (10분 전 도착)',
                  location: 'Paradise Dynasty Breeze Xinyi',
                  completed: false
                },
                {
                  id: 'd2-xinyi-party',
                  time: '20:00',
                  title: '신이 지구 크리스마스 파티',
                  type: 'moon',
                  description: '스누피 조형물, 크리스마스 거리 공연, 타이페이 101 야경 감상',
                  location: 'Taipei 101 Area',
                  completed: false
                },
                {
                  id: 'd2-move-hotel-end',
                  time: '21:30',
                  title: '호텔로 이동 및 휴식',
                  type: 'transport',
                  description: 'MRT 시청역(Blue) -> 난징푸싱역(Green)까지 환승 후 복귀',
                  location: 'Tai Hope Hotel',
                  completed: false
                }
              ]
            },
            {
              day: 3,
              date: '12월 26일 (금)',
              title: '예스폭진지 버스 투어',
              events: [
                {
                  id: 'd3-start',
                  time: '09:15',
                  title: '호텔 출발',
                  type: 'transport',
                  description: '메인역으로 이동 (약 30분 소요)',
                  location: 'Taipei Main Station',
                  completed: false
                },
                {
                  id: 'd3-meet',
                  time: '09:50',
                  title: '투어 미팅 집결',
                  type: 'tour',
                  description: '타이베이 메인역 M3 출구 지하',
                  location: 'Taipei Main Station M3 Exit',
                  link: 'https://naver.me/5gYfOlmZ',
                  completed: false
                },
                {
                  id: 'd3-yehliu',
                  time: '11:10',
                  title: '예류 지질공원',
                  type: 'camera',
                  description: '여왕머리 바위 등 기암괴석 관람',
                  location: 'Yehliu Geopark',
                  completed: false
                },
                {
                  id: 'd3-shifen',
                  time: '13:20',
                  title: '스펀 천등 날리기',
                  type: 'activity',
                  description: '기찻길 천등 & 닭날개 볶음밥',
                  location: 'Shifen Old Street',
                  completed: false
                },
                {
                  id: 'd3-waterfall',
                  time: '14:50',
                  title: '스펀 폭포',
                  type: 'camera',
                  description: '대만의 나이아가라 폭포',
                  location: 'Shifen Waterfall',
                  completed: false
                },
                {
                id: 'd3-jinguashi',
                  time: '16:30',
                  title: '진과스',
                  type: 'tour',
                  description: '황금박물관 & 광부도시락',
                  location: 'Jinguashi Gold Museum',
                  completed: false
                },
                {
                  id: 'd3-jiufen',
                  time: '18:00',
                  title: '지우펀',
                  type: 'camera',
                  description: '센과 치히로 배경지 야경',
                  location: 'Jiufen Old Street',
                  completed: false
                },
                {
                  id: 'd3-drop',
                  time: '20:30',
                  title: '투어 종료 및 하차',
                  type: 'bus',
                  description: '시먼딩/메인역 하차',
                  location: 'Taipei Main Station',
                  completed: false
                }
              ]
            },
            {
              day: 4,
              date: '12월 27일 (토)',
              title: '문화 유산 & 단수이 노을',
              events: [
                {
                  id: 'd4-start',
                  time: '09:00',
                  title: '호텔 -> 고궁박물원',
                  type: 'transport',
                  description: 'MRT 스린역 1번출구 -> 버스 환승',
                  location: 'National Palace Museum',
                  completed: false
                },
                {
                  id: 'd4-museum',
                  time: '10:00',
                  title: '국립 고궁박물원',
                  type: 'landmark',
                  description: '세계 4대 박물관 관람',
                  location: 'National Palace Museum',
                  completed: false,
                  knowledgeContent: {
                    title: '🏛️ 국립 고궁박물원 완전 정복',
                    text: `1. 역사: 장제스가 대만으로 넘어올 때 자금성의 핵심 유물 70만 점을 가져왔습니다. 3~6개월마다 전시품이 교체되어 "평생을 봐도 다 못 본다"는 말이 있습니다.
          
            2. 관람 동선 꿀팁:
               - 효율적인 동선: 3층에서 가장 유명한 '옥배추'와 '육형석'을 먼저 관람하신 후, 2층과 1층으로 내려오며 둘러보시는 것을 추천합니다. (302호 전시실이 핵심!)
               - 오디오 가이드: 한국어 오디오 가이드를 대여하면 유물에 얽힌 숨은 이야기를 들을 수 있어 관람이 훨씬 풍성해집니다.
               - 복장: 박물관 실내는 유물 보존을 위해 온도가 낮게 유지되니 얇은 겉옷을 챙기세요.
               
            3. 주요 보물:
               - 취옥백채(Jade Cabbage): 흰색과 녹색이 섞인 옥을 이용해 배추를 조각했습니다. 배추 위의 여치는 다산을 상징합니다.
               - 육형석: 가공하지 않은 천연석이 동파육 고기와 똑같이 생겼습니다. 껍질의 모공까지 정교합니다.
               - 상아투화운룡문괴구: 하나의 상아를 깎아 그 안에 17개의 움직이는 공을 조각한 미스터리한 공예품입니다.`
                  }
                },
                {
                  id: 'd4-move-tamsui',
                  time: '13:00',
                  title: '단수이로 이동',
                  type: 'transport',
                  description: 'MRT 레드라인 단수이행 탑승',
                  location: 'Tamsui Station',
                  completed: false
                },
                {
                  id: 'd4-tamsui',
                  time: '14:30',
                  title: '단수이 여행',
                  type: 'sunset',
                  description: '라오제, 홍마오청, 워런마터우',
                  location: 'Tamsui Old Street',
                  completed: false,
                  knowledgeContent: {
                    title: '🌅 낭만의 항구 도시, 단수이',
                    text: `1. 이동 팁: 단수이역 2번 출구에서 R26번 버스를 타면 홍마오청, 진리대학, 워런마터우까지 한 번에 갈 수 있습니다.
        
            2. 사진 명소:
               - 홍마오청: 붉은 벽돌 건물이 파란 하늘과 대비되어 사진이 정말 잘 나옵니다. 
               - 담강중학교: 영화 <말할 수 없는 비밀> 촬영지입니다. 주걸륜이 다녔던 학교이기도 합니다. (개방 여부 확인 필요)
        
            3. 워런마터우의 석양:
               - 해 질 녘(17:00~)에 맞춰 '연인의 다리'로 가세요. 스타벅스 야외 테라스나 다리 위에서 보는 일몰이 장관입니다.`
                  }
                },
                {
                  id: 'd4-move-hotel',
                  time: '20:00',
                  title: '호텔로 복귀 (워런마터우 출발)',
                  type: 'transport',
                  description: 'R26 버스 -> 단수이역(Red) -> 중산역 환승(Green) -> 난징푸싱역 하차',
                  location: 'Tai Hope Hotel',
                  completed: false
                }
              ]
            },
            {
              day: 5,
              date: '12월 28일 (일)',
              title: '귀국',
              events: [
                {
                  id: 'd5-check',
                  time: '13:00',
                  title: '공항 이동',
                  type: 'transport',
                  description: '호텔 -> 타오위안 공항',
                  location: 'Taoyuan International Airport',
                  completed: false
                },
                {
                  id: 'd5-flight',
                  time: '17:00',
                  title: '타오위안 출발',
                  type: 'flight',
                  description: '타이거에어 IT606 / 부산 향발',
                  location: 'Taoyuan International Airport',
                  completed: false
                }
              ]
            }
          ]
        
          const [itinerary, setItinerary] = useState(() => {
            // 버전 변경 시 localStorage 키도 변경하여 이전 데이터와 충돌 방지
            const saved = localStorage.getItem('taiwanTripData_v20'); 
            if (saved) {
              return JSON.parse(saved);
            }
            return initialItinerary;
          });
        
          const [selectedDay, setSelectedDay] = useState(1);
          const [showGuideModal, setShowGuideModal] = useState(false);
          const [knowledgeModalData, setKnowledgeModalData] = useState(null);
          
          // AI 관련 state 제거: showAIChat, chatMessages, userInput, isLoadingAI, chatEndRef
          
          // AI 관련 함수 제거: callGeminiAPI, handleSendMessage, AIChatModal
          
            const toggleComplete = (dayIndex, eventId) => {
              const newItinerary = [...itinerary];
              const dayEvents = newItinerary[dayIndex].events;
              const eventIndex = dayEvents.findIndex(e => e.id === eventId);
              if (eventIndex !== -1) {
                dayEvents[eventIndex].completed = !dayEvents[eventIndex].completed;
                setItinerary(newItinerary);
              }
            };
          
            useEffect(() => {
              localStorage.setItem('taiwanTripData_v20', JSON.stringify(itinerary));
            }, [itinerary]);
            
            const openMap = (location) => {
              const query = encodeURIComponent(location);
              window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            };
          
            const getIcon = (type) => {
              // 아이콘 겹침 문제 해결을 위해 아이콘 크기를 조정하고, 체크박스 아이콘은 
              // EventCard 컴포넌트에서 별도로 처리하여 겹침을 확실히 방지
              const className = "w-4 h-4"; 
              switch (type) {
                case 'flight': return <Icon iconType="flight" className={className} />;
                case 'hotel': return <Icon iconType="hotel" className={className} />;
                case 'tour': return <Icon iconType="tour" className={className} />;
                case 'guide': return <Icon iconType="guide" className={className} />;
                case 'camera': return <Icon iconType="camera" className={className} />;
                case 'food': return <Icon iconType="food" className={className} />;
                case 'activity': return <Icon iconType="activity" className={className} />;
                case 'bus': return <Icon iconType="bus" className={className} />;
                case 'transport': return <Icon iconType="transport" className={className} />;
                case 'landmark': return <Icon iconType="landmark" className={className} />;
                case 'sunset': return <Icon iconType="sunset" className={className} />;
                case 'moon': return <Icon iconType="moon" className={className} />;
                default: return <Icon iconType="MapPin" className={className} />;
              }
            };
          
            const currentDayData = itinerary.find(d => d.day === selectedDay);
          
            // 동선 가이드 모달
            const WaitingInfoModal = () => (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm" onClick={() => setShowGuideModal(false)}>
                <div className="bg-white rounded-xl max-w-md w-full max-h-[85vh] flex flex-col shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                  <div style={{ backgroundColor: PRIMARY_COLOR }} className="p-4 flex justify-between items-center text-white sticky top-0 z-10">
                    <h3 className="text-lg font-bold flex items-center gap-2">
                      <Icon iconType="info" className="w-5 h-5" /> 동선 가이드
                    </h3>
                    <button onClick={() => setShowGuideModal(false)} style={{ backgroundColor: PRIMARY_COLOR, opacity: 0.8 }} className="p-1 rounded">
                      <Icon iconType="x" className="w-5 h-5" />
                    </button>
                  </div>
                  
                  <div className="p-6 overflow-y-auto space-y-4">
                     <p className="font-bold text-gray-800 text-base leading-relaxed">
                       📍 15:40 시먼딩 도착 후 동선 가이드입니다.
                     </p>
                     <ul className="list-disc list-inside space-y-2 text-gray-700 text-sm pl-2">
                       <li>1. 삼미식당 웨이팅: 시먼딩 도착 직후 삼미식당으로 이동하여 웨이팅 명단에 이름을 먼저 올리세요.</li>
                       <li>2. 일성주자소 방문: 웨이팅 시간을 고려하여 일성주자소(도보 이동 가능)로 이동하여 도장을 구경하거나 제작을 의뢰합니다.</li>
                       <li>3. 용산사 관람: 일성주자소에서 용산사로 이동하여 여유롭게 관람 및 점괘 체험을 합니다.</li>
                       <li>4. 저녁 식사: 예상 시간(17:10)에 맞춰 삼미식당으로 복귀하여 식사합니다.</li>
                     </ul>
                     <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-xs text-gray-600 mt-4">
                       * 삼미식당은 웨이팅이 길 수 있으므로, 식당 오픈 시간 근처에 도착하는 경우 웨이팅 전략이 중요합니다.
                     </div>
                  </div>
                  
                  <div className="p-4 border-t border-gray-100 bg-gray-50 z-10">
                    <button 
                      onClick={() => setShowGuideModal(false)}
                      style={{ backgroundColor: PRIMARY_COLOR }}
                      className="w-full text-white py-3 rounded-lg font-bold transition-colors hover:opacity-80"
                    >
                      확인했습니다
                    </button>
                  </div>
                </div>
              </div>
            );
          
          
            const GuideModal = () => (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm" onClick={() => setShowGuideModal(false)}>
                <div className="bg-white rounded-xl max-w-md w-full max-h-[85vh] flex flex-col shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                  <div className="bg-orange-500 p-4 flex justify-between items-center text-white sticky top-0 z-10">
                    <h3 className="text-lg font-bold flex items-center gap-2">
                      <Icon iconType="info" className="w-5 h-5" /> 픽업 미팅 포인트
                    </h3>
                    <button onClick={() => setShowGuideModal(false)} className="hover:bg-orange-600 p-1 rounded">
                      <Icon iconType="x" className="w-5 h-5" />
                    </button>
                  </div>
                  
                  <div className="p-6 overflow-y-auto space-y-6">
                     <div className="flex gap-4">
                       <div className="flex-shrink-0 w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-bold">1</div>
                       <div>
                         <h4 className="font-bold text-gray-800 mb-1">입국장 로비 이동</h4>
                         <p className="text-sm text-gray-600 leading-relaxed">
                           짐을 찾고 도착장으로 나오세요. 정면에 <strong>[Digital Clock]</strong> 전광판이 보이면, 그 기준 <strong>우측 방향 [North Meeting Point]</strong> 쪽으로 이동하세요.
                         </p>
                       </div>
                     </div>
                     <div className="flex gap-4">
                       <div className="flex-shrink-0 w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-bold">2</div>
                       <div>
                         <h4 className="font-bold text-gray-800 mb-1">North Meeting Point 기둥</h4>
                         <p className="text-sm text-gray-600 leading-relaxed">
                           <strong>[N 북회면점 / North Meeting Point]</strong>라고 적힌 기둥에 도착하면, 기둥 <strong>오른쪽에 있는 출구</strong>를 통해 밖으로 나가세요.
                         </p>
                       </div>
                     </div>
                     <div className="flex gap-4">
                       <div className="flex-shrink-0 w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-bold">3</div>
                       <div>
                         <h4 className="font-bold text-gray-800 mb-1">30번 차로 표지판 찾기</h4>
                         <p className="text-sm text-gray-600 leading-relaxed">
                           밖으로 나가서 <strong>우회전</strong>하시면 <strong>[30번 차로 표지판]</strong>이 보입니다.
                         </p>
                       </div>
                     </div>
                     <div className="flex gap-4">
                       <div className="flex-shrink-0 w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center font-bold">4</div>
                       <div>
                         <h4 className="font-bold text-gray-800 mb-1">픽업 장소 도착</h4>
                         <p className="text-sm text-gray-600 leading-relaxed">
                           <strong>[Lane 30 signboard] 아래</strong>가 미팅 포인트입니다. 도착 후 기사님께 연락주세요. (교통 상황에 따라 위치 변동 가능)
                         </p>
                       </div>
                     </div>
                     <div className="bg-gray-50 p-3 rounded-lg border border-gray-200 text-xs text-gray-500 mt-4">
                       * 공항 사정에 따라 혼잡할 수 있으니 짐을 찾으신 후 바로 이동해 주세요.
                     </div>
                  </div>
                  
                  <div className="p-4 border-t border-gray-100 bg-gray-50 z-10">
                    <button 
                      onClick={() => setShowGuideModal(false)}
                      className="w-full bg-orange-500 text-white py-3 rounded-lg font-bold hover:bg-orange-600 transition-colors"
                    >
                      확인했습니다
                    </button>
                  </div>
                </div>
              </div>
            );
          
            const KnowledgeModal = ({ data }) => (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 backdrop-blur-sm" onClick={() => setKnowledgeModalData(null)}>
                <div className="bg-white rounded-xl max-w-md w-full max-h-[85vh] flex flex-col shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                  <div style={{ backgroundColor: PRIMARY_COLOR }} className="p-4 flex justify-between items-center text-white sticky top-0 z-10">
                    <h3 className="text-lg font-bold flex items-center gap-2">
                      <Icon iconType="bookopen" className="w-5 h-5" /> 여행 지식
                    </h3>
                    <button onClick={() => setKnowledgeModalData(null)} style={{ backgroundColor: PRIMARY_COLOR, opacity: 0.8 }} className="p-1 rounded">
                      <Icon iconType="x" className="w-5 h-5" />
                    </button>
                  </div>
                  <div className="p-0 overflow-y-auto">
                    <div className="p-6">
                      <h4 className="text-xl font-extrabold text-gray-800 mb-4 pb-2 border-b border-gray-100">
                        {data.title}
                      </h4>
                      <div className="text-gray-700 whitespace-pre-line leading-relaxed text-sm">
                        {data.text}
                      </div>
                    </div>
                  </div>
                  <div className="p-4 border-t border-gray-100 bg-gray-50 z-10">
                    <button 
                      onClick={() => setKnowledgeModalData(null)}
                      style={{ backgroundColor: PRIMARY_COLOR }}
                      className="w-full text-white py-3 rounded-lg font-bold hover:opacity-80 transition-colors"
                    >
                      닫기
                    </button>
                  </div>
                </div>
              </div>
            );
          
            return (
              <div className="min-h-screen bg-gray-50 font-sans max-w-md mx-auto shadow-lg border-x border-gray-200 relative">
                <header style={{ backgroundColor: PRIMARY_COLOR }} className="text-white shadow-md sticky top-0 z-20"> 
                  <div className="p-6 pb-2">
                    <h1 className="text-2xl font-bold mb-1">🇹🇼 대만 여행</h1>
                    <div className="flex flex-col gap-1 mb-4">
                      <p className="opacity-90 text-sm flex items-center gap-2">
                        <Icon iconType="flight" className="w-4 h-4" /> 2025.12.24 - 12.28
                      </p>
                      <button 
                        onClick={() => openMap('Tai Hope Hotel')}
                        className="flex items-center gap-1.5 text-sm font-medium text-white hover:text-gray-100 transition-colors w-fit" 
                      >
                        <Icon iconType="home" className="w-4 h-4" /> 
                        <span className="underline underline-offset-4 decoration-white/50">숙소: 타이호프 호텔</span> 
                      </button>
                    </div>
                  </div>
                  
                  <div className="flex gap-2 overflow-x-auto no-scrollbar pb-3 px-4">
                    {itinerary.map((day) => (
                      <button
                        key={day.day}
                        onClick={() => setSelectedDay(day.day)}
                        className={`flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all duration-200 whitespace-nowrap ${
                          selectedDay === day.day
                            ? 'bg-white text-gray-800 shadow-md transform scale-105' 
                            : 'bg-white/30 text-white hover:bg-white/40' 
                        }`}
                      >
                        {day.day}일차
                      </button>
                    ))}
                  </div>
                </header>
          
                {/* pb-24 제거: AI 버튼 및 푸터 제거로 인해 불필요한 패딩 제거 */}
                <main className="p-4 space-y-4 pb-8">
                  <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center text-center">
                      <h2 className="text-gray-500 text-sm font-bold mb-1">{currentDayData.date}</h2>
                      <h3 style={{ color: PRIMARY_COLOR }} className="text-xl font-extrabold">{currentDayData.title}</h3> 
                  </div>
          
                  <div className="space-y-3">
                    {currentDayData.events.map((event) => (
                      <div 
                        key={event.id} 
                        className={`relative p-5 rounded-2xl border transition-all duration-200 ${
                          event.completed 
                            ? 'bg-gray-50 border-gray-200 opacity-60' 
                            : 'bg-white border-gray-100 shadow-sm hover:shadow-md'
                        }`}
                      >
                        <div className="flex gap-4">
                          
                          <div className="flex-shrink-0 w-12 pt-0.5">
                            <span className={`text-lg font-bold leading-none ${event.completed ? 'text-gray-400' : 'text-gray-800'}`}>
                              {event.time}
                            </span>
                          </div>
          
                          {/* 내용 영역 */}
                          <div className="flex-1 min-w-0 flex flex-col gap-1.5">
                            <div className="flex items-start gap-2">
                              {/* 일정 타입 아이콘 */}
                              <div style={{ color: event.completed ? '#9ca3af' : PRIMARY_COLOR }} className={`mt-1 flex-shrink-0`}> 
                                  {getIcon(event.type)}
                              </div>
                              <h4 className={`text-lg font-bold text-gray-800 leading-snug ${event.completed ? 'line-through text-gray-400' : ''}`}>
                                  {event.title}
                              </h4>
                            </div>
                            
                            <p className="text-sm text-gray-500 leading-relaxed">{event.description}</p>
                            
                            <div className="flex flex-wrap gap-2 mt-1">
                              <button 
                                onClick={(e) => { e.stopPropagation(); openMap(event.location); }}
                                className="flex items-center gap-1.5 text-xs font-bold bg-gray-50 text-gray-600 px-3 py-1.5 rounded-full border border-gray-200 hover:bg-gray-100 transition-colors"
                              >
                                <Icon iconType="map" className="w-3 h-3" /> 지도
                              </button>
          
                              {/* 동선 가이드 버튼 */}
                              {event.hasWaitingInfo && (
                                <button 
                                  onClick={(e) => { e.stopPropagation(); setShowGuideModal(true); }}
                                  style={{ color: PRIMARY_COLOR, borderColor: PRIMARY_COLOR + '33', backgroundColor: PRIMARY_COLOR + '1A' }} 
                                  className="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-full transition-colors hover:opacity-80" 
                                >
                                  <Icon iconType="guide" className="w-3 h-3" /> 동선 가이드
                                </button>
                              )}
          
                              {event.hasGuideContent && (
                                <button 
                                  onClick={(e) => { e.stopPropagation(); setShowGuideModal(true); }}
                                  className="flex items-center gap-1.5 text-xs font-bold bg-orange-50 text-orange-600 px-3 py-1.5 rounded-full border border-orange-100 hover:bg-orange-100 transition-colors animate-pulse"
                                >
                                  <Icon iconType="guide" className="w-3 h-3" /> 픽업 가이드
                                </button>
                              )}
          
                              {event.link && (
                                <a 
                                  href={event.link}
                                  target="_blank"
                                  rel="noreferrer"
                                  onClick={(e) => e.stopPropagation()}
                                  className="flex items-center gap-1.5 text-xs font-bold bg-green-50 text-green-600 px-3 py-1.5 rounded-full border border-green-100 hover:bg-green-100 transition-colors"
                                >
                                  <Icon iconType="externalLink" className="w-3 h-3" /> 투어 정보
                                </a>
                              )}
          
                              {event.knowledgeContent && (
                                <button 
                                  onClick={(e) => { e.stopPropagation(); setKnowledgeModalData(event.knowledgeContent); }}
                                  className="flex items-center gap-1.5 text-xs font-bold bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-full border border-indigo-100 hover:bg-indigo-100 transition-colors"
                                >
                                  <Icon iconType="bookopen" className="w-3 h-3" /> 여행 지식
                                </button>
                              )}
                            </div>
                          </div>
          
                          {/* 완료 체크박스 (아이콘 겹침 방지 위해 레이아웃 재구성) */}
                          <div className="flex-shrink-0 pt-1">
                            <button 
                              onClick={() => toggleComplete(selectedDay - 1, event.id)}
                              className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${
                                event.completed 
                                  ? 'bg-green-500 border-green-500 text-white' 
                                  : 'border-gray-200 text-gray-400 hover:border-green-400'
                              }`}
                            >
                              {/* 완료 시 흰색 체크 표시, 미완료 시 투명/회색 원 표시 */}
                              <Icon 
                                iconType="checkcircle" 
                                className="w-4 h-4" 
                                isCompleted={event.completed} 
                                color={event.completed ? 'white' : 'currentColor'} 
                              />
                            </button>
                          </div>
          
                        </div>
                      </div>
                    ))}
                  </div>
                </main>
          
                {/* Floating AI Chat Button 제거됨 */}
                
                {/* Modals */}
                {showGuideModal && (currentDayData.events.find(e => e.hasWaitingInfo) ? <WaitingInfoModal /> : <GuideModal />)}
                {knowledgeModalData && <KnowledgeModal data={knowledgeModalData} />}
                
                {/* Footer 메시지 제거됨 */}
              </div>
            );
          };
          
          // --- React Render ---
          const App = () => {
              const [isLoaded, setIsLoaded] = useState(false);
  
              useEffect(() => {
                  setIsLoaded(true);
              }, []);
          
              if (!isLoaded) return <div>로딩 중...</div>;
  
              return <TaiwanTravelApp />;
          }
  
          const root = createRoot(document.getElementById('root'));
          root.render(<App />);

    </script>
</body>
</html>
